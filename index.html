<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0">
<title>Nebula Photo Adventure</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#000;
  touch-action:none;
  font-family:system-ui, sans-serif;
}
canvas{display:block}

/* UI */
#ui{
  position:fixed;
  top:14px; left:14px;
  background:rgba(20,20,30,.6);
  backdrop-filter:blur(10px);
  border-radius:14px;
  padding:12px 14px;
  color:#fff;
  font-size:12px;
}
#ui button{
  background:#222;
  border:0;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  margin:4px 2px;
}
#tip{
  position:fixed;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  color:#aaa;
  opacity:.7;
}
</style>
</head>

<body>
<canvas id="c"></canvas>

<div id="ui">
  <b>üåå Nebula Photo Adventure</b><br>
  ‚Ä¢ foto = meteor tersebar<br>
  ‚Ä¢ max 20 foto aktif<br>
  ‚Ä¢ zoom = petualangan<br><br>
  <button id="play">‚ñ∂ Play</button>
  <button id="pause">‚è∏ Pause</button>
  <button id="auto">üß≠ Auto Tour</button>
</div>

<div id="tip">drag = geser ‚Ä¢ pinch = zoom</div>

<audio id="music" src="music.mp3" loop></audio>

<script>
/* ========= CONFIG ========= */
const TOTAL_PHOTO = 43;
const MAX_RENDER = 20;

const MIN_R = 600;
const MAX_R = 2000;

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const music = document.getElementById('music');

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener('resize', resize);

/* ========= CAMERA ========= */
const cam = { x:0, y:0, zoom:1 };
let dragging=false, lx=0, ly=0;

/* ========= METEOR ========= */
const meteors=[];

function randRing(){
  const r = Math.sqrt(Math.random()*(MAX_R*MAX_R - MIN_R*MIN_R) + MIN_R*MIN_R);
  const a = Math.random()*Math.PI*2;
  return { x:Math.cos(a)*r, y:Math.sin(a)*r };
}

for(let i=1;i<=TOTAL_PHOTO;i++){
  const img=new Image();
  img.src=`fotos/${i}.jpg`;
  const p=randRing();
  meteors.push({
    img,
    x:p.x,
    y:p.y,
    size:40+Math.random()*40
  });
}

/* ========= INTERACTION ========= */
canvas.onpointerdown=e=>{
  dragging=true;
  lx=e.clientX; ly=e.clientY;
}
canvas.onpointerup=()=>dragging=false;
canvas.onpointermove=e=>{
  if(!dragging) return;
  cam.x-=(e.clientX-lx)/cam.zoom;
  cam.y-=(e.clientY-ly)/cam.zoom;
  lx=e.clientX; ly=e.clientY;
}
canvas.onwheel=e=>{
  cam.zoom*=e.deltaY>0?0.9:1.1;
  cam.zoom=Math.min(3,Math.max(.5,cam.zoom));
}

/* ========= AUTO TOUR ========= */
let auto=false, t=0;
document.getElementById('auto').onclick=()=>auto=!auto;

/* ========= MUSIC ========= */
play.onclick=()=>music.play();
pause.onclick=()=>music.pause();

/* ========= DRAW ========= */
function draw(){
  requestAnimationFrame(draw);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // nebula
  const g=ctx.createRadialGradient(
    canvas.width/2,canvas.height/2,100,
    canvas.width/2,canvas.height/2,canvas.width
  );
  g.addColorStop(0,'#223');
  g.addColorStop(1,'#000');
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(auto){
    t+=0.002;
    cam.x=Math.cos(t)*800;
    cam.y=Math.sin(t*1.3)*600;
    cam.zoom=1.2+Math.sin(t)*0.2;
  }

  // hitung jarak & sort
  const visible=meteors.map(m=>{
    const dx=m.x-cam.x, dy=m.y-cam.y;
    return {...m, d:Math.hypot(dx,dy)};
  }).sort((a,b)=>a.d-b.d).slice(0,MAX_RENDER);

  for(const m of visible){
    const sx=(m.x-cam.x)*cam.zoom+canvas.width/2;
    const sy=(m.y-cam.y)*cam.zoom+canvas.height/2;

    const scale=Math.max(0,1-m.d/2200);
    const s=m.size*scale*cam.zoom;

    if(s<6) continue;

    ctx.save();
    ctx.globalAlpha=scale;
    ctx.beginPath();
    ctx.arc(sx,sy,s/2,0,Math.PI*2);
    ctx.clip();
    ctx.drawImage(m.img,sx-s/2,sy-s/2,s,s);
    ctx.restore();
  }
}
draw();
</script>
</body>
  </html>
